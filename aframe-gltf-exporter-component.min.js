!function(e){function r(n){if(t[n])return t[n].exports;var a=t[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,r),a.loaded=!0,a.exports}var t={};return r.m=e,r.c=t,r.p="",r(0)}([function(e,r,t){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");t(1),AFRAME.registerSystem("gltf-exporter",{schema:{verbose:{default:!1}},multiple:!1,init:function(){this.link=document.createElement("a"),this.link.style.display="none",document.body.appendChild(this.link),this.exporter=new THREE.GLTFExporter},download:function(e,r){this.link.href=URL.createObjectURL(e),this.link.download=r,this.link.click()},downloadBinary:function(e,r){this.download(new Blob([e],{type:"application/octet-stream"}),r)},downloadJSON:function(e,r){this.download(new Blob([e],{type:"application/json"}),r)},export:function(e,r){var t;t="undefined"==typeof e?this.sceneEl.object3D:e instanceof Array?e.map(function(e){return e.object3D}):e instanceof NodeList?Array.prototype.slice.call(e).map(function(e){return e.object3D}):e.object3D;var n=this;this.exporter.parse(t,function(e){if(r&&r.binary===!0)n.downloadBinary(e,"scene.glb");else{var t=JSON.stringify(e,null,2);n.data.verbose&&console.log(t),n.downloadJSON(t,"scene.gltf")}},r)}})},function(e,r){var t={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987},n={1003:t.NEAREST,1004:t.NEAREST_MIPMAP_NEAREST,1005:t.NEAREST_MIPMAP_LINEAR,1006:t.LINEAR,1007:t.LINEAR_MIPMAP_NEAREST,1008:t.LINEAR_MIPMAP_LINEAR},a={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};THREE.GLTFExporter=function(){},THREE.GLTFExporter.prototype={constructor:THREE.GLTFExporter,parse:function(e,r,i){function s(e,r){return e.length===r.length&&e.every(function(e,t){return e===r[t]})}function o(e){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(e).buffer;for(var r=new Uint8Array(new ArrayBuffer(e.length)),t=0,n=e.length;t<n;t++){var a=e.charCodeAt(t);r[t]=a>255?32:a}return r.buffer}function l(e,r,t){for(var n={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},a=r;a<r+t;a++)for(var i=0;i<e.itemSize;i++){var s=e.array[a*e.itemSize+i];n.min[i]=Math.min(n.min[i],s),n.max[i]=Math.max(n.max[i],s)}return n}function u(e){return THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height)}function c(e){return 4*Math.ceil(e/4)}function f(e,r){r=r||0;var t=c(e.byteLength);if(t!==e.byteLength){var n=new Uint8Array(t);if(n.set(new Uint8Array(e)),0!==r)for(var a=e.byteLength;a<t;a++)n[a]=r;return n.buffer}return e}function h(e){return L.buffers||(L.buffers=[{byteLength:0}]),_.push(e),0}function p(e,r,n,a,i){L.bufferViews||(L.bufferViews=[]);var s;s=r===t.UNSIGNED_BYTE?1:r===t.UNSIGNED_SHORT?2:4;for(var o=c(a*e.itemSize*s),l=new DataView(new ArrayBuffer(o)),u=0,f=n;f<n+a;f++)for(var p=0;p<e.itemSize;p++){var m=e.array[f*e.itemSize+p];r===t.FLOAT?l.setFloat32(u,m,!0):r===t.UNSIGNED_INT?l.setUint32(u,m,!0):r===t.UNSIGNED_SHORT?l.setUint16(u,m,!0):r===t.UNSIGNED_BYTE&&l.setUint8(u,m),u+=s}var d={buffer:h(l.buffer),byteOffset:F,byteLength:o};void 0!==i&&(d.target=i),i===t.ARRAY_BUFFER&&(d.byteStride=e.itemSize*s),F+=o,L.bufferViews.push(d);var g={id:L.bufferViews.length-1,byteLength:0};return g}function m(e){return L.bufferViews||(L.bufferViews=[]),new Promise(function(r){var t=new window.FileReader;t.readAsArrayBuffer(e),t.onloadend=function(){var e=f(t.result),n={buffer:h(e),byteOffset:F,byteLength:e.byteLength};F+=e.byteLength,L.bufferViews.push(n),r(L.bufferViews.length-1)}})}function d(e,r,n,a){L.accessors||(L.accessors=[]);var s,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"};if(e.array.constructor===Float32Array)s=t.FLOAT;else if(e.array.constructor===Uint32Array)s=t.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)s=t.UNSIGNED_SHORT;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");s=t.UNSIGNED_BYTE}if(void 0===n&&(n=0),void 0===a&&(a=e.count),i.truncateDrawRange&&void 0!==r&&null===r.index){var u=n+a,c=r.drawRange.count===1/0?e.count:r.drawRange.start+r.drawRange.count;n=Math.max(n,r.drawRange.start),a=Math.min(u,c)-n,a<0&&(a=0)}var f,h=l(e,n,a);void 0!==r&&(f=e===r.index?t.ELEMENT_ARRAY_BUFFER:t.ARRAY_BUFFER);var m=p(e,s,n,a,f),d={bufferView:m.id,byteOffset:m.byteOffset,componentType:s,count:a,max:h.max,min:h.min,type:o[e.itemSize]};return L.accessors.push(d),L.accessors.length-1}function g(e){L.images||(L.images=[]);var r=e.format===THREE.RGBAFormat?"image/png":"image/jpeg",t={mimeType:r};if(i.embedImages){var n=S=S||document.createElement("canvas");n.width=e.image.width,n.height=e.image.height,i.forcePowerOfTwoTextures&&!u(e.image)&&(console.warn("GLTFExporter: Resized non-power-of-two image.",e.image),n.width=THREE.Math.floorPowerOfTwo(n.width),n.height=THREE.Math.floorPowerOfTwo(n.height));var a=n.getContext("2d");e.flipY===!0&&(a.translate(0,n.height),a.scale(1,-1)),a.drawImage(e.image,0,0,n.width,n.height),i.binary===!0?O.push(new Promise(function(e){n.toBlob(function(r){m(r).then(function(r){t.bufferView=r,e()})},r)})):t.uri=n.toDataURL(r)}else t.uri=e.image.src;return L.images.push(t),L.images.length-1}function E(e){L.samplers||(L.samplers=[]);var r={magFilter:n[e.magFilter],minFilter:n[e.minFilter],wrapS:n[e.wrapS],wrapT:n[e.wrapT]};return L.samplers.push(r),L.samplers.length-1}function T(e){if(G.textures.has(e))return G.textures.get(e);L.textures||(L.textures=[]);var r={sampler:E(e),source:g(e)};L.textures.push(r);var t=L.textures.length-1;return G.textures.set(e,t),t}function v(e){if(G.materials.has(e))return G.materials.get(e);if(L.materials||(L.materials=[]),e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;var r={pbrMetallicRoughness:{}};e.isMeshBasicMaterial?(r.extensions={KHR_materials_unlit:{}},B.KHR_materials_unlit=!0):e.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var t=e.color.toArray().concat([e.opacity]);if(s(t,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=t),e.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):e.isMeshBasicMaterial?(r.pbrMetallicRoughness.metallicFactor=0,r.pbrMetallicRoughness.roughnessFactor=.9):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5),(e.metalnessMap||e.roughnessMap)&&(e.metalnessMap===e.roughnessMap?r.pbrMetallicRoughness.metallicRoughnessTexture={index:T(e.metalnessMap)}:console.warn("THREE.GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.")),e.map&&(r.pbrMetallicRoughness.baseColorTexture={index:T(e.map)}),e.isMeshBasicMaterial||e.isLineBasicMaterial||e.isPointsMaterial);else{var n=e.emissive.clone().multiplyScalar(e.emissiveIntensity).toArray();s(n,[0,0,0])||(r.emissiveFactor=n),e.emissiveMap&&(r.emissiveTexture={index:T(e.emissiveMap)})}e.normalMap&&(r.normalTexture={index:T(e.normalMap)},e.normalScale.x!==-1&&(e.normalScale.x!==e.normalScale.y&&console.warn("THREE.GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),r.normalTexture.scale=e.normalScale.x)),e.aoMap&&(r.occlusionTexture={index:T(e.aoMap)},1!==e.aoMapIntensity&&(r.occlusionTexture.strength=e.aoMapIntensity)),(e.transparent||e.alphaTest>0)&&(r.alphaMode=e.opacity<1?"BLEND":"MASK",e.alphaTest>0&&.5!==e.alphaTest&&(r.alphaCutoff=e.alphaTest)),e.side===THREE.DoubleSide&&(r.doubleSided=!0),""!==e.name&&(r.name=e.name),L.materials.push(r);var a=L.materials.length-1;return G.materials.set(e,a),a}function w(e){L.meshes||(L.meshes=[]);var r,n=e.geometry;if(e.isLineSegments)r=t.LINES;else if(e.isLineLoop)r=t.LINE_LOOP;else if(e.isLine)r=t.LINE_STRIP;else if(e.isPoints)r=t.POINTS;else{if(!n.isBufferGeometry){var a=new THREE.BufferGeometry;a.fromGeometry(n),n=a}e.drawMode===THREE.TriangleFanDrawMode?(console.warn("GLTFExporter: TriangleFanDrawMode and wireframe incompatible."),r=t.TRIANGLE_FAN):r=e.drawMode===THREE.TriangleStripDrawMode?e.material.wireframe?t.LINE_STRIP:t.TRIANGLE_STRIP:e.material.wireframe?t.LINES:t.TRIANGLES}var s={},o={},l=[],u=[],c={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"};for(var f in n.attributes){var h=n.attributes[f];f=c[f]||f.toUpperCase();var p=h.array;"JOINTS_0"!==f||p instanceof Uint16Array||p instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),h=new THREE.BufferAttribute(new Uint16Array(p),h.itemSize,h.normalized)),"MORPH"!==f.substr(0,5)&&(o[f]=d(h,n))}if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){var m=[],g=[],E={};if(void 0!==e.morphTargetDictionary)for(var T in e.morphTargetDictionary)E[e.morphTargetDictionary[T]]=T;for(var w=0;w<e.morphTargetInfluences.length;++w){var R={},y=!1;for(var f in n.morphAttributes)if("position"===f||"normal"===f){for(var h=n.morphAttributes[f][w],b=n.attributes[f],A=h.clone(),I=0,N=h.count;I<N;I++)A.setXYZ(I,h.getX(I)-b.getX(I),h.getY(I)-b.getY(I),h.getZ(I)-b.getZ(I));R[f.toUpperCase()]=d(A,n)}else y||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),y=!0);u.push(R),m.push(e.morphTargetInfluences[w]),void 0!==e.morphTargetDictionary&&g.push(E[w])}s.weights=m,g.length>0&&(s.extras={},s.extras.targetNames=g)}var M=i.forceIndices,x=Array.isArray(e.material);!M&&null===n.index&&x&&(console.warn("THREE.GLTFExporter: Creating index for non-indexed multi-material mesh."),M=!0);var S=!1;if(null===n.index&&M){for(var F=[],w=0,_=n.attributes.position.count;w<_;w++)F[w]=w;n.setIndex(F),S=!0}for(var O=x?e.material:[e.material],U=x?e.geometry.groups:[{materialIndex:0,start:void 0,count:void 0}],w=0,_=U.length;w<_;w++){var P={mode:r,attributes:o};u.length>0&&(P.targets=u);var B=v(O[U[w].materialIndex]);null!==B&&(P.material=B),null!==n.index&&(P.indices=d(n.index,n,U[w].start,U[w].count)),l.push(P)}return S&&n.setIndex(null),s.primitives=l,L.meshes.push(s),L.meshes.length-1}function R(e){L.cameras||(L.cameras=[]);var r=e.isOrthographicCamera,t={type:r?"orthographic":"perspective"};return r?t.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:t.perspective={aspectRatio:e.aspect,yfov:THREE.Math.degToRad(e.fov)/e.aspect,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(t.name=e.type),L.cameras.push(t),L.cameras.length-1}function y(e,r){L.animations||(L.animations=[]);for(var t=[],n=[],i=0;i<e.tracks.length;++i){var s=e.tracks[i],o=THREE.PropertyBinding.parseTrackName(s.name),l=THREE.PropertyBinding.findNode(r,o.nodeName),u=a[o.propertyName];if("bones"===o.objectName&&(l=l.isSkinnedMesh===!0?l.skeleton.getBoneByName(o.objectIndex):void 0),!l||!u)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',s.name),null;var c=1,f=s.values.length/s.times.length;u===a.morphTargetInfluences&&(f/=l.morphTargetInfluences.length);var h;s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(h="CUBICSPLINE",f/=3):h=s.getInterpolation()===THREE.InterpolateDiscrete?"STEP":"LINEAR",n.push({input:d(new THREE.BufferAttribute(s.times,c)),output:d(new THREE.BufferAttribute(s.values,f)),interpolation:h}),t.push({sampler:n.length-1,target:{node:U.get(l),path:u}})}return L.animations.push({name:e.name||"clip_"+L.animations.length,samplers:n,channels:t}),L.animations.length-1}function b(e){var r=L.nodes[U.get(e)],t=e.skeleton,n=e.skeleton.bones[0];if(void 0===n)return null;for(var a=[],i=new Float32Array(16*t.bones.length),s=0;s<t.bones.length;++s)a.push(U.get(t.bones[s])),t.boneInverses[s].toArray(i,16*s);void 0===L.skins&&(L.skins=[]),L.skins.push({inverseBindMatrices:d(new THREE.BufferAttribute(i,16)),joints:a,skeleton:U.get(n)});var o=r.skin=L.skins.length-1;return o}function A(e){if(e.isLight)return console.warn("GLTFExporter: Unsupported node type:",e.constructor.name),null;L.nodes||(L.nodes=[]);var r={};if(i.trs){var t=e.quaternion.toArray(),n=e.position.toArray(),a=e.scale.toArray();s(t,[0,0,0,1])||(r.rotation=t),s(n,[0,0,0])||(r.translation=n),s(a,[1,1,1])||(r.scale=a)}else e.updateMatrix(),s(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(r.matrix=e.matrix.elements);if(""!==e.name&&(r.name=String(e.name)),e.userData&&Object.keys(e.userData).length>0)try{r.extras=JSON.parse(JSON.stringify(e.userData))}catch(e){throw new Error("THREE.GLTFExporter: userData can't be serialized")}if(e.isMesh||e.isLine||e.isPoints?r.mesh=w(e):e.isCamera&&(r.camera=R(e)),e.isSkinnedMesh&&P.push(e),e.children.length>0){for(var o=[],l=0,u=e.children.length;l<u;l++){var c=e.children[l];if(c.visible||i.onlyVisible===!1){var f=A(c);null!==f&&o.push(f)}}o.length>0&&(r.children=o)}L.nodes.push(r);var h=L.nodes.length-1;return U.set(e,h),h}function I(e){L.scenes||(L.scenes=[],L.scene=0);var r={nodes:[]};""!==e.name&&(r.name=e.name),L.scenes.push(r);for(var t=[],n=0,a=e.children.length;n<a;n++){var s=e.children[n];if(s.visible||i.onlyVisible===!1){var o=A(s);null!==o&&t.push(o)}}t.length>0&&(r.nodes=t)}function N(e){var r=new THREE.Scene;r.name="AuxScene";for(var t=0;t<e.length;t++)r.children.push(e[t]);I(r)}function M(e){e=e instanceof Array?e:[e];for(var r=[],t=0;t<e.length;t++)e[t]instanceof THREE.Scene?I(e[t]):r.push(e[t]);r.length>0&&N(r);for(var t=0;t<P.length;++t)b(P[t]);for(var t=0;t<i.animations.length;++t)y(i.animations[t],e[0])}var x={trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,animations:[],forceIndices:!1,forcePowerOfTwoTextures:!1};i=Object.assign({},x,i),i.animations.length>0&&(i.trs=!0);var S,L={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},F=0,_=[],O=[],U=new Map,P=[],B={},G={materials:new Map,textures:new Map};M(e),Promise.all(O).then(function(){var e=new Blob(_,{type:"application/octet-stream"}),t=Object.keys(B);if(t.length>0&&(L.extensionsUsed=t),L.buffers&&L.buffers.length>0){L.buffers[0].byteLength=e.size;var n=new window.FileReader;if(i.binary===!0){var a=12,s=1179937895,l=2,u=8,c=1313821514,h=5130562;n.readAsArrayBuffer(e),n.onloadend=function(){var e=f(n.result),t=new DataView(new ArrayBuffer(u));t.setUint32(0,e.byteLength,!0),t.setUint32(4,h,!0);var i=f(o(JSON.stringify(L)),32),p=new DataView(new ArrayBuffer(u));p.setUint32(0,i.byteLength,!0),p.setUint32(4,c,!0);var m=new ArrayBuffer(a),d=new DataView(m);d.setUint32(0,s,!0),d.setUint32(4,l,!0);var g=a+p.byteLength+i.byteLength+t.byteLength+e.byteLength;d.setUint32(8,g,!0);var E=new Blob([m,p,i,t,e],{type:"application/octet-stream"}),T=new window.FileReader;T.readAsArrayBuffer(E),T.onloadend=function(){r(T.result)}}}else n.readAsDataURL(e),n.onloadend=function(){var e=n.result;L.buffers[0].uri=e,r(L)}}else r(L)})}}}]);